<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Edit Link Preview</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
  <style>
    body { font-family: system-ui, -apple-system, Roboto, Arial; padding:16px; background:#f7f8fb; color:#111; }
    .card { background:white; padding:12px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,.06); max-width:760px; margin:0 auto; }
    label { display:block; font-size:12px; margin-top:8px; color:#444; }
    input, textarea { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; border:1px solid #e6e6e6; border-radius:6px; font-size:14px; }
    button { margin-top:12px; width:100%; padding:10px; border-radius:8px; border:0; background:#0b74de; color:#fff; font-weight:700; }
    .preview { margin-top:12px; display:flex; gap:12px; align-items:flex-start; }
    .preview img { width:120px; height:80px; object-fit:cover; border-radius:6px; }
    .preview .meta { flex:1; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .link-back { text-decoration:none; color:#0b74de; font-weight:600; }
  </style>
</head>
<body>
  <div class="topbar">
    <a class="link-back" href="/">‚Üê Back</a>
    <div>Edit link preview</div>
    <div></div>
  </div>

  <div class="card">
    <label>Title</label>
    <input id="meta-title" placeholder="Title">

    <label>Description</label>
    <textarea id="meta-description" rows="3" placeholder="Description"></textarea>

    <label>Image URL (absolute, HTTPS recommended)</label>
    <input id="meta-image" placeholder="https://yourdomain.com/path/to/image.jpg">

    <label>Canonical / Share URL</label>
    <input id="meta-url" placeholder="https://yourdomain.com/">

    <button id="meta-save">Save preview</button>
    <div id="meta-status" style="margin-top:10px;font-size:13px;color:#333"></div>

    <div class="preview" style="margin-top:12px">
      <img id="preview-image" src="" alt="">
      <div class="meta">
        <div id="preview-title" style="font-weight:700"></div>
        <div id="preview-desc" style="color:#555;font-size:13px;margin-top:6px"></div>
      </div>
    </div>
  </div>

  <script>
    async function loadMeta() {
      try {
        const r = await fetch('/api/meta', { cache: 'no-store' });
        const j = await r.json();
        document.getElementById('meta-title').value = j.title || '';
        document.getElementById('meta-description').value = j.description || '';
        document.getElementById('meta-image').value = j.image || '';
        document.getElementById('meta-url').value = j.url || '';
        refreshPreview();
      } catch(e) { console.error(e); }
    }

    function refreshPreview() {
      document.getElementById('preview-title').textContent = document.getElementById('meta-title').value;
      document.getElementById('preview-desc').textContent = document.getElementById('meta-description').value;
      const img = document.getElementById('meta-image').value || '';
      document.getElementById('preview-image').src = img;
    }

    document.getElementById('meta-title').addEventListener('input', refreshPreview);
    document.getElementById('meta-description').addEventListener('input', refreshPreview);
    document.getElementById('meta-image').addEventListener('input', refreshPreview);

    document.getElementById('meta-save').addEventListener('click', async () => {
      const payload = {
        title: document.getElementById('meta-title').value,
        description: document.getElementById('meta-description').value,
        image: document.getElementById('meta-image').value,
        url: document.getElementById('meta-url').value
      };
      try {
        const res = await fetch('/api/meta', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        if (json.success) {
          document.getElementById('meta-status').textContent = 'Saved. Crawlers will show the new preview when they next scrape (use cache-busting to force).';
          setTimeout(()=>location.href='/',800);
        } else {
          document.getElementById('meta-status').textContent = json.message || 'Save failed';
        }
      } catch (err) {
        document.getElementById('meta-status').textContent = 'Network error';
      }
    });

    // load on open
    loadMeta();
  </script>
</body>
</html>
